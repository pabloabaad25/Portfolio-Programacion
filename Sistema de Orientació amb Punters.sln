// PROGRAMA --> Sistema de Targeting en C++.cpp
// AUTOR --> Pablo Abad Ortega
// FECHA --> 27/11/2025

#include <iostream> // libreria de entrada y salida de datos
using namespace std; // espacio de nombres
#include <cmath> // para la funcion sqrt()

struct Enemigo
{
    int id; // identificador unico
    double x; // coordenadas X
    double y; // coordenadas Y
    int healt_point; // puntos de vida 
};

Enemigo* generar_enemigos(int& cantidad)
{
    do
    {
        cout << "INTRODUCE UNA CANTIDAD DE ENEMIGOS (MIN. 3): " << endl;
        cin >> cantidad;

    } while (cantidad < 3); // validacion del minimo de enemigos    

    // reservar la memoria en una array de una cantidad de enemigos dado por la variable "cantidad".
    Enemigo* Array_Enemigo = new Enemigo[cantidad]; // creamos una array de cantidad enemigos

    // Rellenar array con los datos de "enemigos"
    for (int i = 0; i < cantidad; i++)
    {
        Array_Enemigo[i].id = i + 1;
        Array_Enemigo[i].x = rand() % 20 - 10; // Posicion aleatoria entre -10 i 10
        Array_Enemigo[i].y = rand() % 20 - 10;
        Array_Enemigo[i].healt_point = 100; // vida inicial de enemigo
        cout << "ENEMIGO GENERADO ID --> " << Array_Enemigo[i].id
            << " en (" << Array_Enemigo[i].x << ", " << Array_Enemigo[i].y << ")" << endl;
    }
    return Array_Enemigo;
}

// FUNCIO DE TROBAR ENEMIC MES APROP AMB RETORN DEL PUNTER
Enemigo* Buscar_Enemigo(Enemigo* lista, int cantidad)
{
    Enemigo* mas_cercano = nullptr; // Punter buit 
    double distancia_minima = 1000000.0; // un número molt gran per comença
    cout << "[Sistema de orientación activado]" << endl;

    for (int i = 0; i < cantidad; i++)
    {
        // FORMULAS DE LA DISTANCIA raíz(x^2 + y^2) asumiendo jugador a (0,0)
        double distancia = sqrt(pow(lista[i].x, 2) + pow(lista[i].y, 2));

        // actualiztar punteri distancia minima
        if (distancia < distancia_minima && lista[i].healt_point > 0)
        {
            distancia_minima = distancia;
            mas_cercano = &lista[i]; // guarda la direccion de la memoria del enemigo 
        }
    }
    
    if (mas_cercano != nullptr)
    {
        cout << "ENEMIGO MÁS CERCANO -> ID --> " << mas_cercano->id << endl;
        cout << "DISTANCIA --> " << distancia_minima << endl;
    }

    return mas_cercano; // retornael punter a l'enemic escollit
}

// FUNCIO PER FER MAL AMB EL PUNTER
void daño(Enemigo* objetivo)
{
    if (objetivo == nullptr) return; // seguretat en cas de que no hi hagi l'enemic

    cout << "Aplicando daño!" << endl;
    int valor_daño = 50;

    // modifico la vida primera amb l'operador (->)
    int vida_abans = objetivo->healt_point;
    objetivo->healt_point -= valor_daño;

    cout << "Enemigo " << objetivo->id << " HP --> " << vida_abans << " -> " << objetivo->healt_point << endl;

    if (objetivo->healt_point <= 0)
    {
        cout << "ENEMIGO DESTRUIDO!" << endl;
    }
}
int main() // inicio del programa
{
    int numero_enemigos = 0;

    // paso el numero_enemigos a referecnia pq la funcio es ompli
    Enemigo* enemigos_mios = generar_enemigos(numero_enemigos);

    // buscar el mas cercano a mi
    Enemigo* target = Buscar_Enemigo(enemigos_mios, numero_enemigos);

    // ataco dos vagadas
    if (target != nullptr)
    {
        daño(target);
        daño(target);
    }

    // netejar la memoria 
    delete[] enemigos_mios;
    cout << "SE HA LIBERADO MEMORIA, ADIOS!" << endl;

    return 0;
}
